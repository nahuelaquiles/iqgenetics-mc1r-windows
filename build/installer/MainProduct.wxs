<?xml version="1.0" encoding="utf-8"?>
<!--
  WiX v4 installer for IQ Genetics MC1R.

  IMPORTANT:
  WiX needs ONE "entry section" of type <Package> to build an MSI.
  If a .wxs file contains only <Fragment> blocks, WiX throws:
    WIX0093: Expected section of type 'Package'

  This file includes:
    - <Package> entry section (fixes WIX0093)
    - StandardDirectory usage (removes WIX5437 warnings)
    - INSTALLFOLDER + Start Menu shortcut
    - Feature that installs harvested published files + shortcut
-->
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs">

  <!-- ENTRY POINT (required to build MSI) -->
  <Package
    Name="$(var.ProductName)"
    Manufacturer="$(var.Manufacturer)"
    Version="$(var.PackageVersion)"
    UpgradeCode="$(var.UpgradeCode)"
    Language="1033"
    Scope="perMachine">

    <MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />
    <MediaTemplate EmbedCab="yes" />

    <!-- Main feature that installs harvested files + Start Menu shortcut -->
    <Feature Id="MainFeature" Title="IQ Genetics MC1R Sanger Automation" Level="1">
      <ComponentGroupRef Id="PublishedFiles" />
      <ComponentRef Id="StartMenuShortcut" />
    </Feature>
  </Package>

  <!-- Installation directories -->
  <Fragment>
    <StandardDirectory Id="ProgramFiles64Folder">
      <Directory Id="INSTALLFOLDER" Name="IQ Genetics MC1R Sanger Automation" />
    </StandardDirectory>
  </Fragment>

  <!-- Start Menu folder (use a custom ID to avoid redefining standard directories) -->
  <Fragment>
    <StandardDirectory Id="ProgramMenuFolder">
      <Directory Id="StartMenuDir" Name="IQ Genetics MC1R Sanger Automation" />
    </StandardDirectory>
  </Fragment>

  <!-- Start-menu shortcut component -->
  <Fragment>
    <Component Id="StartMenuShortcut" Directory="StartMenuDir" Guid="D5774AA1-F836-4BF6-9205-DFC4F77D6751">
      <Shortcut Id="ApplicationStartMenuShortcut"
                Name="IQ Genetics MC1R Sanger Automation"
                Target="[INSTALLFOLDER]IQGenetics.MC1R.App.exe"
                WorkingDirectory="INSTALLFOLDER" />
      <RemoveFolder Id="RemoveStartMenuDir" On="uninstall" />

      <!-- Registry entry to mark installation -->
      <RegistryValue Root="HKCU"
                     Key="Software\\IQ Genetics / GECORP\\IQ Genetics MC1R Sanger Automation"
                     Name="Installed"
                     Type="integer"
                     Value="1"
                     KeyPath="yes" />
    </Component>
  </Fragment>

</Wix>
